--- 
jobs: 
  build: 
    docker: 
      container_name: integration-tests
      environment: 
        MYSQL_DATABASE: tests
        MYSQL_ROOT_PASSWORD: prisma
      image: "mysql:oracle"
      ports: 
        - "5000:3306"
    steps: 
      - checkout
      - 
        restore_cache: 
          keys: 
            - "v1-dependencies-{{ checksum \"package.json\" }}"
            - v1-dependencies-
      - 
        run: "npm install"
      - 
        save_cache: 
          key: "v1-dependencies-{{ checksum \"package.json\" }}"
          paths: 
            - node_modules
      - 
        run: "npm test"
      - 
        setup_remote_docker: 
          docker_layer_caching: true
      - 
        run: 
          command: |
              set -x
              VER="18.06.3-ce"
              curl -L -o /tmp/docker-$VER.tgz https://download.docker.com/linux/static/stable/x86_64/docker-$VER.tgz
              tar -xz -C /tmp -f /tmp/docker-$VER.tgz
              mv /tmp/docker/* /usr/bin
          name: "Install Docker client"
      - 
        run: "yarn ci:docker"
    working_directory: ~/repo
version: 2